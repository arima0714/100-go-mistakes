# No.3: init 関数の誤用

init 関数の基礎は下記の通り

```
package main

var a = func() int {
	println("var")
	return 0
}()

func init() {
	println("init")
}

func main() {
	println("main")
}
```

上記のコードを実行すると下記の出力がある。

```
var
init
main
```

１つのパッケージに対して複数のinit関数を定義できるが、それらinit関数の実行順序はソースファイルのアルファベット順である。

init 関数の順序には依存すべきではない。なぜならソースファイル名が変更されるたびに、実行順序に変更の危機が訪れるから。

同じソースファイル内で複数のinit関数を定義可能で、実装順に実行される。

import の中で ブランク識別子 `_` を使ってパッケージを導入すると、導入したパッケージに強く依存しないコードになる。ブランク識別子 `_` を使って導入されたパッケージのinit関数はmainパッケージのinit関数の前に呼び出される。

また、init関数は好きなタイミングで呼び出せない。

init関数内でのエラーハンドリングは手段が限られている。テストケース実行ごとにinit関数が呼び出されるが、それが悪い場合がある。そして、グローバル変数をいじると、他の記述でもそのグローバル変数をいじることができるので、気を付ける箇所が一つ増える。

上記のような問題を抱えることになるコードでやるべきことはカプセルかであり、普通の関数として実装すべきである。こうして実装した関数を利用することで、下記の利点を得られる。

* エラー処理の責任は呼び出し元に任せられる
* 動作確認のために結合テストを作成できる
* グローバル変数に保持していた内容を関数内にカプセル化できる。

init関数の利用時には注意すべき点が多いが、静的な設定の定義など、状況によっては適した実装がある。

